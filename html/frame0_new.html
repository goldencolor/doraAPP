<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>首页</title>

    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/2_0/aui_2_0.css"/>
    <link rel="stylesheet" type="text/css" href="../css/2_0/rem.css"/>
    <link rel="stylesheet" type="text/css" href="../css/2_0/util.css"/>
    <link rel="stylesheet" type="text/css" href="../css/fonts/duola_iconfont2.css"/>
    <link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
    <style>
        /*图标栅格部分*/
        .icon-item i {
            font-size: 1.05rem;
            color: #707070;
        }

        .icon-item .aui-grid-label {
            font-family: SourceHanSansCN-Light;
            font-size: 0.6rem;
            padding-top: 0.1rem;
            color: #959595;
        }

        .hotCloset-item {
            margin-bottom: 0.85rem;
        }

        .hotCloset-item .hotCloset-header {
            padding: 1rem 0.5rem 0.7rem 0.5rem;
        }

        .hotCloset-item .hotCloset-header .title {
            font-family: SourceHanSansCN-Normal;
            font-size: 0.8rem;
            color: #000000;
        }

        .hotCloset-item .hotCloset-header .en-name {
            font-family: ArialMT;
            font-size: 0.9rem;
            color: #707070;
            letter-spacing: 0px;
            font-weight: bold;
        }

        .hotCloset-item .hotCloset-header .more {
            padding: 0.3rem 0;
            font-family: ArialMT;
            font-size: 0.55rem;
            color: #A6A6A6;
            text-align: right;
        }

        .hotCloset-item .hotCloset-header .more span {
            font-size: 0.35rem;
            color: #A6A6A6;
            margin-left: 0.1rem;
        }

        .shadow-5 {
            width: 100%;
            height: 0.5rem;
            background: #F8F8F8;
            /*box-shadow: inset 0px 1px 1px 0px rgba(0,0,0,0.15);*/
        }

        .shadow-13 {
            width: 100%;
            height: 0.65rem;
            background: #EBEBEB;
            box-shadow: inset 0px 1px 1px 0px rgba(0, 0, 0, 0.15);
        }

        #theme-group-container .waterfall .item img {
            height: 10.5rem;
        }

        .hack-space {
            display: inline-block;
            width: 0.75rem;
        }

        #other-ad-container div.progressive {
            min-height: 4.5rem;
        }

        #theme-group-container div.progressive {
            min-height: 14.55rem;
        }

        /*--------------------similar-----------------------*/
        .similar {
            background-color: #FFFFFF;
        }

        .similar .like {
            font-family: SourceHanSansCN-Normal;
            font-size: 0.8rem;
            width: 100%;
            text-align: center;
            padding: 0.7rem 0 0.3rem;
            color: #000000;
        }

        .similar .item {
            width: 5rem;
            height: 6.75rem;
            text-align: center;
            margin-right: 0.3rem;
        }

        .similar .item .imgBox {
            width: 2.5rem;
            height: 2.5rem;
            margin: 0.7rem auto 0.6rem;
            overflow: hidden;
        }

        .similar .item .imgBox img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 1px solid #cccccc;
        }

        .similar .item .discribleBox {
            width: 100%;
            overflow: hidden;
        }

        .similar .item .discribleBox .name {
            font-family: SourceHanSansCN-Regular;
            font-size: 0.5rem;
            line-height: 0.6rem;
            color: #A6A6A6;
            height: 1.2rem;
        }

        .similar .item .discribleBox .text {
            font-family: SourceHanSansCN-Regular;
            font-size: 0.6rem;
            line-height: 0.7rem;
            margin-top: 0.25rem;
            color: #000000;
        }

        .similar .like-bottom {
            font-family: SourceHanSansCN-Light;
            font-size: 0.6rem;
            color: #707070;
            text-align: center;
            padding-bottom: 0.25rem;
        }
    </style>
</head>
<body>
<div id="UIScrollPicture"></div>
<div class="aui-grid">
    <div class="aui-row">
        <div class="aui-col-xs-3 icon-item" tapmode onclick="goPopularity('model')">
            <!--<i class="duola-iconfont icon-love"></i>-->
            <img src="../image/love.png" alt="" style="width: 30%;height: auto;padding-bottom: 0.3rem">
            <div class="aui-grid-label">人气</div>
        </div>
        <div class="aui-col-xs-3 icon-item" tapmode onclick="goYearVip()">
            <!--<i class="duola-iconfont icon-annual" style="color: #FF6100;"></i>-->
            <img src="../image/que.png" alt="" style="width: 30%;height: auto;padding-bottom: 0.3rem">
            <div class="aui-grid-label">年费专享</div>
        </div>
        <div class="aui-col-xs-3 icon-item" tapmode onclick="goSeason()">
            <!--<i class="duola-iconfont icon-spring"></i>-->
            <img src="../image/flower.png" alt="" style="width: 30%;height: auto ;padding-bottom: 0.3rem">
            <div class="aui-grid-label">春季预选</div>
        </div>
        <div class="aui-col-xs-3 icon-item" tapmode onclick="goChoose()">
            <!--<i class="duola-iconfont icon-star"></i>-->
            <img src="../image/star.png" alt="" style="width: 30%;height: auto;padding-bottom: 0.3rem">
            <div class="aui-grid-label">选衣达人</div>
        </div>
    </div>
</div>
<div id="other-ad-container"></div>
<div class="shadow-5"></div>

<div id="similar-container" class="similar">

    <!--<div class="like">他们的穿衣风格和你很接近哟</div>-->
    <!--<div class="like-bottom">看看她们都在怎么穿</div>-->
    <!--<div class="swiper-container">-->
    <!--<div class="swiper-wrapper">-->
    <!--<div class="swiper-slide item" tapmode onclick="openCommunity(this)" data-info='{"time":"2016-10-14","tel":"18381334038","similar":"80%","avatar":"FqBvQ8beih2BpPjKP/avatar/1478331917503280550","nickname":"一言不和就开车"}'>-->
    <!--<div class="imgBox">-->
    <!--<img onload="cacheImgNew(this,'img','no')" src="../image/avatar.png" class="opacity0 transition-opacity" data-url="http://wx.qlogo.cn/mmopen/PiajxSqBRaEIyXDySaWrUAT09D8SaBmetadxA0boB1jgFJPe5j9Bkmk2xzpEiahk61GibGn3v9AEqlAjmbQayqEDQ/0" width="100%" />-->
    <!--</div>-->
    <!--<div class="discribleBox">-->
    <!--<div class="name word-wrap-2">乌拉乌拉乌拉乌拉乌拉乌拉乌拉乌拉乌拉乌拉乌拉乌拉乌拉乌拉</div>-->
    <!--<div class="text">衣橱相似度80%</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="swiper-slide item">-->
    <!--<div class="imgBox"><img src="../image/weixin.png" alt=""></div>-->
    <!--<div class="discribleBox">-->
    <!--<div class="name">乌拉乌拉</div>-->
    <!--<div class="text">衣橱相似度80%</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="swiper-slide item">-->
    <!--<div class="imgBox"><img src="../image/weixin.png" alt=""></div>-->
    <!--<div class="discribleBox">-->
    <!--<div class="name">乌拉乌拉</div>-->
    <!--<div class="text">衣橱相似度80%</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="swiper-slide item">-->
    <!--<div class="imgBox"><img src="../image/weixin.png" alt=""></div>-->
    <!--<div class="discribleBox">-->
    <!--<div class="name">乌拉乌拉</div>-->
    <!--<div class="text">衣橱相似度80%</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="shadow-5"></div>-->

</div>

<div id="theme-group-container">

    <!--<div class="theme-group-item">-->
    <!--<img class="duo-cache-img" src="http://img.duolayimeng.com/public/image/theme-muzuheng.jpg@40q" />-->
    <!--<div class="shadow-13"></div>-->
    <!--<img class="duo-cache-img" src="http://img.duolayimeng.com/public/image/theme-muzuheng.jpg@40q" />-->
    <!--<div class="shadow-13"></div>-->
    <!--<div class="hotCloset-item">-->
    <!--<div class="hotCloset-header flex flex-space-between flex-vertical-center">-->
    <!--<div><b class="title">人气排行</b><span class="en-name">&nbsp;|&nbsp;PARTY GIRL</span></div>-->
    <!--<div class="more flex flex-vertical-center" tapmode onclick="goMore()">MORE<span class="duola-iconfont icon-right"></span></div>-->
    <!--</div>-->
    <!--<div class="cloudset-container waterfall">-->
    <!--<div class="swiper-container">-->
    <!--<div class="swiper-wrapper">-->
    <!--<div class="item swiper-slide" tapmode onclick="showClothes()">-->
    <!--<div class="header">-->
    <!--<img class="swiper-lazy" src="http://img.duolayimeng.com/original/1517718-1.jpg@320h" alt=""/>-->
    <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
    <!--<div class="label flex flex-space-between">-->
    <!--<div class="new">new</div>-->
    <!--<div class="unavailable">抢光了</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--&lt;!&ndash;<div class="footer flex flex-space-between flex-vertical-center">&ndash;&gt;-->
    <!--&lt;!&ndash;<div class="name flex-1 aui-ellipsis-1">宽松蕾罩衫宽松蕾罩衫宽松蕾罩衫宽松蕾罩衫宽松蕾罩衫宽松蕾罩衫宽松蕾罩衫</div>&ndash;&gt;-->
    <!--&lt;!&ndash;<div class="number"><span class="duola-iconfont icon-love"></span>136</div>&ndash;&gt;-->
    <!--&lt;!&ndash;</div>&ndash;&gt;-->
    <!--</div>-->
    <!--<div class="item swiper-slide" tapmode onclick="showClothes()">-->
    <!--<div class="header">-->
    <!--<img class="swiper-lazy" src="http://img.duolayimeng.com/original/1517718-1.jpg@320h" alt=""/>-->
    <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
    <!--<div class="label flex flex-space-between">-->
    <!--<div class="new">new</div>-->
    <!--<div class="unavailable">抢光了</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="item swiper-slide" tapmode onclick="showClothes()">-->
    <!--<div class="header">-->
    <!--<img class="swiper-lazy" src="http://img.duolayimeng.com/original/1517718-1.jpg@320h" alt=""/>-->
    <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
    <!--<div class="label flex flex-space-between">-->
    <!--<div class="new">new</div>-->
    <!--<div class="unavailable">抢光了</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="item swiper-slide" tapmode onclick="showClothes()">-->
    <!--<div class="header">-->
    <!--<img class="swiper-lazy" src="http://img.duolayimeng.com/original/1517718-1.jpg@320h" alt=""/>-->
    <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
    <!--<div class="label flex flex-space-between">-->
    <!--<div class="new">new</div>-->
    <!--<div class="unavailable">抢光了</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--<div class="shadow-13"></div>-->
    <!--</div>-->

</div>
<div style="height:2.5rem;"></div>
<!--  主题图片模板 -->
<script id="theme-group-container-template" type="text/x-dot-template">
    {{ for(var i = 0; i < it.preItem; i++) { }}
    <div class="theme-group-item">
        {{ for(var j = 0; j < it.preTheme; j++) { }}
        <div class="progressive" tapmode
             onclick="{{=getExecScript('goThemeDatail',[it.themes.list[i*it.preTheme+j]._id,i*it.preTheme+j])}}">
            <img class="progressive__img progressive--not-loaded"
                 data-progressive="{{=getImgUrl(imgPath,it.themes.list[i*it.preTheme+j].img,CONSTANT.PICTUREOSS.Q80)}}"
                 src="{{=getImgUrl(imgPath,it.themes.list[i*it.preTheme+j].img,CONSTANT.PICTUREOSS.Q25)}}"
                 width="100%"/>
        </div>
        <div class="shadow-13"></div>
        {{ } }}
        {{ for(var k = 0; k < it.preGroup; k++) { }}
        <div class="hotCloset-item">
            <div class="hotCloset-header flex flex-space-between flex-vertical-center">
                <div>
                    <b class="title">{{=it.groups.list[i*it.preGroup+k].name}}</b>{{?it.groups.list[i*it.preGroup+k].en_name}}<span
                    class="en-name"><i class="hack-space"></i>|<i class="hack-space"></i>{{=upperEnName(it.groups.list[i*it.preGroup+k].en_name)}}</span>{{?}}
                </div>
                <div class="more flex flex-vertical-center" tapmode
                     onclick="{{=getExecScript('goMore',[it.groups.list[i*it.preGroup+k].name])}}">MORE<span
                    class="duola-iconfont icon-right"></span></div>
            </div>
            <div class="cloudset-container waterfall">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        {{ for(var m = 0; m < it.groups.list[i*it.preGroup+k].count; m++) { }}
                        <div class="item swiper-slide" tapmode
                             onclick="{{=getExecScript('showClothes',it.groups.list[i*it.preGroup+k].name == CONSTANT.TEXT.PRESELBEFORE ? [it.groups.list[i*it.preGroup+k].list[m]._id,CONSTANT.TEXT.PRESELBEFORE] : [it.groups.list[i*it.preGroup+k].list[m]._id])}}">
                            <div class="header">
                                <img
                                    src="{{=getImgUrl(colthPath, it.groups.list[i*it.preGroup+k].list[m].img, CONSTANT.PICTUREOSS.CLOTHESLIST)}}"
                                    class="swiper-lazy"
                                    title="{{=getImgUrl(colthPath, it.groups.list[i*it.preGroup+k].list[m].img, CONSTANT.PICTUREOSS.CLOTHESLIST)}}"/>
                                <div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>
                            </div>
                        </div>
                        {{ } }}
                    </div>
                </div>
            </div>
        </div>
        {{? i != it.preItem -1 }}
        <div class="shadow-13"></div>
        {{?}}
        {{ } }}
    </div>
    {{ } }}
</script>

<!--其他广告模板-->
<script id="other-ad-container-template" type="text/x-dot-template">
    {{ for(var i = 0; i < it.count; i++) { }}
    <div class="shadow-5"></div>
    <div tapmode onclick="{{=getExecScript('otherAdClickHandler',[i,it.list[i].type,it.list[i].url])}}">
        <div class="progressive">
            <img class="progressive__img progressive--not-loaded"
                 data-progressive="{{=getImgUrl(CONSTANT.PICPRE.IMG,it.list[i].img,CONSTANT.PICTUREOSS.Q80)}}"
                 src="{{=getImgUrl(CONSTANT.PICPRE.IMG,it.list[i].img,CONSTANT.PICTUREOSS.Q15)}}" width="100%"/>
        </div>
    </div>
    {{ } }}
</script>

<!--穿衣同好模版-->
<script id="similar-container-template" type="text/x-dot-template">
    <div class="like">他们的穿衣风格和你很接近哟</div>
    <div class="like-bottom">看看她们都在怎么穿</div>
    <div class="swiper-container-similar" style="margin:0 auto;position:relative;overflow:hidden;z-index:1">
        <div class="swiper-wrapper">
            {{ for(var i = 0; i < it.count; i++) { }}
            <div class="swiper-slide item" tapmode onclick="openCommunity(this,'{{=i}}')">
                <div class="imgBox">
                    <img onload="cacheImgNew(this,'img','no')" src="../image/avatar.png"
                         class="opacity0 transition-opacity"
                         data-url="{{=getAvatar(it.list[i].avatar,it.list[i].avatarFrom)}}" width="100%"/>
                </div>
                <div class="discribleBox">
                    <div class="name flex flex-center word-wrap-2">{{=it.list[i].nickname}}</div>
                    <div class="text">衣橱相似度{{=Math.round(it.list[i].similar.replace('%',''))+'%'}}</div>
                </div>
            </div>
            {{ } }}
        </div>
    </div>
    <div class="shadow-5"></div>
</script>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/url.js"></script>
<script type="text/javascript" src="../script/doT_min.js"></script>
<script type="text/javascript" src="../script/uz.js"></script>
<script type="text/javascript" src="../script/sendInfo.js"></script>
<script type="text/javascript" src="../script/umeng_sdk.js"></script>
<script type="text/javascript" src="../script/swiper.min.js"></script>
<script type="text/javascript" src="../script/progressively.js"></script>
<script type="text/javascript" src="../script/app_ad.js" ></script>
<script type="text/javascript">
    var UIScrollPicture = null;
    var UIScrollPictureUrls = null;
    var isWechat = false;
    var similarData = null;//穿衣同好数据
    apiready = function () {
        appAdInit();//开屏广告初始化
        pullRefresh(loadRefresh);
        init();
//        init(CONSTANT.ACTIONINIT);

        getlocation();//获取地理位置??
        isInstalledWx(function (isIntalled, extra) {
            if (isIntalled) {
                isWechat = true;
            }
        });
        listenLoginEvent();
        getSimilar();
    };

    //监听用户退出事件
    function listenLoginEvent() {
        api.addEventListener({
            name: 'loginEvent'
        }, function (ret, err) {
            getSimilar();
        });
    }

    //    初始化穿衣同好
    function getSimilar() {
        if (!isLogin()) {
            return;
        }
        var url = serviceUser + 'similar/list';
        var headers = _getAjaxHeaders(true, true);
        var data = _getAjaxData();
        _ajaxData(url, 'post', headers, data, getSimilarSuccessCallback, null, 0);
    }

    function getSimilarSuccessCallback(ret) {
        if (ret.statusCode == 200 && ret.count) {
            similarData = ret;
            var html = doTHtml('similar-container-template', ret);
            var similarContainer = $api.byId('similar-container');
            similarContainer.innerHTML = html;
            var swiper = new Swiper('.swiper-container-similar', {
                slidesPerView: 'auto',
                freeMode: true,
                preloadImages: false,
                lazyLoading: true,
                spaceBetween: 0
            });
            api.parseTapmode();
        }
    }

    function openCommunity(el, i) {
        var name = 'community';
        var title = '社区推荐';
        var params = {
            postData: similarData.list[i]
        };
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'community_win.html';
        openNewWin(name, title, params, from, url, {
            type: "fade",                //动画类型（详见动画类型常量）
            duration: 300                //动画过渡时间，默认300毫秒
        });
    }

    function loadRefresh() {
        init(CONSTANT.ACTIONREFRESH);
        getSimilar();
    }
    function initSuccessCallback(ret, extra) {
        var action = extra.action;
        if (action == CONSTANT.ACTIONREFRESH) {
            pullRefreshDone();
        } else {
            loadingHide();
        }
        if (ret.statusCode == 200) {
            if (ret.ad && action != CONSTANT.ACTIONREFRESH) {
                getAdHtml(ret.ad);
            } else if (ret.ad && action == CONSTANT.ACTIONREFRESH) {
                refreshAdHtml(ret.ad);
            }
            if (ret.otherAd && ret.otherAd.count > 0) {
                getOtherAdHtml(ret.otherAd);
            }
            getThemesGroupsHtml(ret);
//			setTimeout(function(){
//				api.removeLaunchView({
//					animation: {
//						type: 'fade',
//						duration: 150
//					}
//				});
//			},150);
        } else {
//			api.removeLaunchView({
//				animation: {
//					type: 'fade',
//					duration: 150
//				}
//			});
            toastMsg(ret.msg);
        }
    }

    function initErrorCallback(err, extra) {
        var action = extra.action;
        if (action == CONSTANT.ACTIONREFRESH) {
            pullRefreshDone();
        } else {
            loadingHide();
        }
        toastMsg(err.msg);
    }

    function init(action) {
        if (action == CONSTANT.ACTIONINIT) {
            loadingShow();
        }
        var url = serviceNew + 'home/new';
        var headers = _getAjaxHeaders(false, true);
        var data = _getAjaxData();
        var extra = {action: action};
        _ajaxData(url, 'post', headers, data, initSuccessCallback, initErrorCallback, 0, extra);
    }
//    testHtml();
    function testHtml() {
		var ret = {"statusCode":200,"ad":{"count":5,"list":[{"img":"Aa2EdcexYw.png","url":"http://mp.weixin.qq.com/s/qTiWVirjnVHrMGteHx3SbQ","name":"拉夏贝尔入驻"},{"img":"hTKAsxFrhY.jpg","url":"https://duola.leanapp.cn/duola","name":"圣诞节翻牌游戏"},{"img":"Q5MF7Keyds.png","url":"https://mp.weixin.qq.com/s/Cs7-VyGyzHHSpucuiFFalg","name":"missf入驻"},{"img":"dExTMAiRZf.jpg","url":"http://mp.weixin.qq.com/s/4azIbXbym5ypd4_3yKlRbg","name":"环保主题"},{"img":"guanyuduola1105_long.jpg","url":"http://mp.weixin.qq.com/s?__biz=MzIyMjA0ODAwMg==&mid=503555218&idx=1&sn=b5eb80d5f594f0b3eb6cd6d9c5ecf272&chksm=73c47eff44b3f7e9df7522c6ceca0abb2c21afc33e539ed0294e6cd0e9d7b9395386b604ca71&scene=1&srcid=0909qfSPWZBfR08HBy4nN6RV#rd","name":"三合一链接"}]},"themes":{"count":26,"list":[{"img":"iQmRiHBM3e.jpg","_id":"ELRMFy55GzhxgexA2"},{"img":"xKcWkNBGSK.jpg","_id":"zqzLxpHp7kaFF7cDM"},{"img":"4NS85ew7Rw.jpg","_id":"gKMQCdjuucWXsSZGc"},{"img":"Jy67ecbPW3.jpg","_id":"FoyQ98ED8pXcSccHX"},{"img":"4s7f24ajsa.jpg","_id":"DwFkx5a7L52DGJ3md"},{"img":"MHpAj7aDk4.jpg","_id":"NuRXsXdbMoJkjoToP"},{"img":"MPZketYFR3.jpg","_id":"hT5oBricntZbyB8pc"},{"img":"72AtWHYC2z.jpg","_id":"AXD5wySZQuaSycHcr"},{"img":"PST2AAHmN7.jpg","_id":"C42eGv9hWCqcrH36Z"},{"img":"68YzGSnHbP.jpg","_id":"RKetiTkHK4JWog2Ht"},{"img":"3m3TZT4kQK.jpg","_id":"t5i8QQ3WQuT5CsqHd"},{"img":"3JEFpNpnC3.jpg","_id":"tryNSjEHbQYki4GN8"},{"img":"58t32BFQWy.jpg","_id":"KcsyrvMyeeBR4YnAd"},{"img":"ZAW2WYX4dd.jpg","_id":"M8N593kJXJsR7eH76"},{"img":"nskpG3GGPS.jpg","_id":"8zEshbHzy4kBPhtMf"},{"img":"theme-lanseheng.jpg","_id":"TtoftvGNiKmrZraQx"},{"img":"theme-lvseheng.jpg","_id":"JETzDD6auwFkLrJPn"},{"img":"theme-fenziheng.jpg","_id":"49Ra29P842Z7Wvna4"},{"img":"theme-meiderenxinghengzz.jpg","_id":"uzwZwR7B5umexmZbt"},{"img":"theme-wennuanruni.jpg","_id":"gnN3bS2G3jKQ4CnLQ"},{"img":"theme-yaoxianheng.jpg","_id":"gK2hBm4Zofrzke96p"},{"img":"theme-duiyanheng.jpg","_id":"bYDfeaDeo8LP3w43D"},{"img":"theme-yuhanmijiheng.jpg","_id":"ZQMq7wZ3iyAeCc4zD"},{"img":"theme-handongkuziheng.jpg","_id":"dgoJh4NCmEpC64Era"},{"img":"theme-nidehaoyouheng.jpg","_id":"Z72hed3gd8GbeqzBR"},{"img":"theme-3lihaileheng.jpg","templateUrl":"","_id":"PzetQm97cLT4HHA6v"}]},"otherAd":{"count":1,"list":[{"img":"ads/rFFwKxRrHT.jpg","type":"internal","_id":"DbN8SR5BDa4Ltjeqq","url":"goFlashLease","name":"闪选"}]},"msg":"OK","groups":{"count":8,"list":[{"count":4,"en_name":"newCome","list":[{"like":153,"_id":"1566229","img":"1566229-1.jpg","title":"唯美暗花纹露肩连衣裙"},{"like":88,"_id":"1566233","img":"1566233-1.jpg","title":"丝绒性感吊带背心裙"},{"like":58,"_id":"1566239","img":"1566239-1.jpg","title":"暗花纹中式棉麻风衣外套"},{"like":82,"_id":"1566256","img":"1566256-1.jpg","title":"蕾丝暗花纹垂坠大灯笼袖上衣"}],"name":"春季预选"},{"count":4,"en_name":"popularity","list":[{"like":454,"_id":"1558474","img":"1558474-1.jpg","title":"灰色长款羽绒服"},{"like":31,"_id":"1559393","img":"1559393-1.jpg","title":"翻领宽松风衣"},{"like":226,"_id":"1561346","img":"1561346-1.jpg","title":"简约黑色棉衣外套"},{"like":86,"_id":"1565241","img":"1565241-1.jpg","title":"休闲短款棉衣"}],"name":"人气排行"},{"count":4,"en_name":"feast","list":[{"like":94,"_id":"1562355","img":"1562355-1.jpg","title":"纯色休闲呢料外套"},{"like":289,"_id":"1565146","img":"1565146-1.jpg","title":"中长款呢大衣"},{"like":191,"_id":"1565536","img":"1565536-1.jpg","title":"休闲双面呢大衣"},{"like":494,"_id":"1566150","img":"1566150-1.jpg","title":"修身显瘦长款纯色毛呢大衣"}],"name":"聚会"},{"count":4,"en_name":"officeWorker","list":[{"like":468,"_id":"1558454","img":"1558454-1.jpg","title":"米白色呢子马甲"},{"like":493,"_id":"1558458","img":"1558458-1.jpg","title":"黑色大袖子呢子大衣（含顺色本布腰带）"},{"like":1064,"_id":"1558464","img":"1558464-1.jpg","title":"浅粉色荷叶袖呢子大衣"},{"like":203,"_id":"1558604","img":"1558604-1.jpg","title":"兔毛毛领大衣"}],"name":"通勤"},{"count":4,"en_name":"renaissance","list":[{"like":140,"_id":"1565386","img":"1565386-1.jpg","title":"黑色长款呢大衣"},{"like":143,"_id":"1565387","img":"1565387-1.jpg","title":"灰色系带大衣"},{"like":133,"_id":"1565407","img":"1565407-1.jpg","title":"英伦风大衣"},{"like":136,"_id":"1565410","img":"1565410-1.jpg","title":"流苏收腰大衣"}],"name":"文艺复古"},{"count":4,"en_name":"sweetLovely","list":[{"like":34,"_id":"1565349","img":"1565349-1.jpg","title":"蓝色短款呢大衣"},{"like":45,"_id":"1565356","img":"1565356-1.jpg","title":"蓝色翻领呢大衣"},{"like":157,"_id":"1565582","img":"1565582-1.jpg","title":"黑色毛呢百褶裙"},{"like":124,"_id":"1565674","img":"1565674-1.jpg","title":"纯色双排扣毛呢大衣"}],"name":"甜美可爱"},{"count":4,"en_name":"suite","list":[{"like":505,"_id":"1527679","img":"1527679-1.jpg","title":"绒套装"},{"like":90,"_id":"1529589","img":"1529589-1.jpg","title":"条纹套装"},{"like":160,"_id":"1559745","img":"1559745-1.jpg","title":"运动风休闲套装"},{"like":383,"_id":"1566155","img":"1566155-1.jpg","title":"气质休闲绣花套装"}],"name":"套装"},{"count":4,"en_name":"originalDesign","list":[{"like":139,"_id":"1561396","img":"1561396-1.jpg","title":"浅蓝色中长款呢大衣"},{"like":352,"_id":"1561525","img":"1561525-1.jpg","title":"八分袖气质毛呢套装"},{"like":188,"_id":"1561794","img":"1561794-1.jpg","title":"中长素版呢大衣"},{"like":340,"_id":"1561796","img":"1561796-1.jpg","title":"中长素版呢大衣"}],"name":"原创设计"}]},"themesCount":"2:1"};
        getThemesGroupsHtml(ret);
//		getOtherAdHtml(ret.otherAd,'test');
        var testData = {
            "count": 4,
            "statusCode": 200,
            "msg": "OK",
            "list": [{
                "time": "2016-08-25",
                "isWxAvatar": "YES",
                "avatar": "http://wx.qlogo.cn/mmopen/OdPDerKVRv8Wm97HjRQicMwicsg5MCatXnpGY2HlO8eAicGf4o4lsFlWrEbzV8MOTNUhiaPPFauSbEFNQcWl8TYzPiaibEbELqGcQg/0",
                "_id": "xXCw7LYxeE6Dpx545",
                "nickname": "韩国允 美容微整",
                "tel": "15065257816",
                "similar": "22.94%"
            }, {
                "time": "2016-08-25",
                "isWxAvatar": "YES",
                "avatar": "http://wx.qlogo.cn/mmopen/OdPDerKVRv8Wm97HjRQicMwicsg5MCatXnpGY2HlO8eAicGf4o4lsFlWrEbzV8MOTNUhiaPPFauSbEFNQcWl8TYzPiaibEbELqGcQg/0",
                "_id": "xXCw7LYxeE6Dpx545",
                "nickname": "韩国允 美容微整",
                "tel": "15065257816",
                "similar": "22.94%"
            }, {
                "time": "2016-08-25",
                "isWxAvatar": "YES",
                "avatar": "http://wx.qlogo.cn/mmopen/OdPDerKVRv8Wm97HjRQicMwicsg5MCatXnpGY2HlO8eAicGf4o4lsFlWrEbzV8MOTNUhiaPPFauSbEFNQcWl8TYzPiaibEbELqGcQg/0",
                "_id": "xXCw7LYxeE6Dpx545",
                "nickname": "韩国允 美容微整",
                "tel": "15065257816",
                "similar": "22.94%"
            }, {
                "time": "2016-08-19",
                "isWxAvatar": "NO",
                "avatar": "BhABdjgFParjewwr6/avatar/pz4Yrv6j",
                "_id": "BhABdjgFParjewwr6",
                "nickname": "A.努力努力再再努力、",
                "tel": "17317440405",
                "similar": "11.79%"
            }]
        };
        getSimilarSuccessCallback(testData);
    }

    //拼接头像url
    function getAvatar(avatar, avatarFrom) {
        if (!!avatarFrom) {
            return avatar;
        } else if (avatar && avatar.indexOf('../') == -1) {
            return [CONSTANT.PICPRE.RES, avatar].join('');
        } else {
            return '';
        }
    }

    function getThemesGroupsHtml(ret) {
        if (ret.themesCount) {
            var preTheme = isNaN(parseInt(ret.themesCount.split(':')[0])) ? 0 : parseInt(ret.themesCount.split(':')[0]);
            var preGroup = isNaN(parseInt(ret.themesCount.split(':')[1])) ? 0 : parseInt(ret.themesCount.split(':')[1]);
            var preItemTheme = preTheme == 0 ? 0 : Math.floor(ret.themes.count / preTheme);
            var preItemGroup = preGroup == 0 ? 0 : Math.floor(ret.groups.count / preGroup);
            var preItem = preItemTheme < preItemGroup ? preItemTheme : preItemGroup;
            var data = {
                preItem: preItem,
                preTheme: preTheme,
                preGroup: preGroup,
                themes: ret.themes,
                groups: ret.groups
            };
            var html = doTHtml('theme-group-container-template', data);
            var themeGroupContainer = $api.byId('theme-group-container');
            themeGroupContainer.innerHTML = html;
            progressively.init({
                delay: 0,
                throttle: 0
            });
            var swiper = new Swiper('.swiper-container', {
                slidesPerView: 2.5,
                freeMode: true,
                preloadImages: false,
                lazyLoading: true,
                spaceBetween: 0
            });
            api.parseTapmode();
        }
    }

    //顶部图片轮放
    function getAdHtml(ad) {
        UIScrollPicture = api.require('UIScrollPicture');
        if (!isDefine(UIScrollPicture)) {
            return;//项目没有加载这个模块
        }
        //更改轮播图片高宽比
        var w = api.winWidth;
        var h = w * 1 / CONSTANT.UISCROLLPICTURERATE;
        var paths = ad.list.map(function (value) {
            return getImgUrl(imgPath, value.img, CONSTANT.PICTUREOSS.Q80);
        });
        UIScrollPictureUrls = ad.list.map(function (value) {
            return {url: value.url, name: value.name};
        });
        UIScrollPicture.open({
            rect: {
                x: 0,
                y: 0,
                w: w,
                h: h
            },
            data: {
                paths: paths
            },
            styles: {
                indicator: {
                    align: 'center',
                    color: '#FFFFFF',
                    activeColor: '#FF6100'
                }
            },
            //缺少占位图
//			placeholderImg:'widget://image/hold.jpg',
            contentMode: 'scaleToFill',
            interval: 4,
            fixedOn: api.frameName,
            loop: true,
            fixed: false
        }, function (ret, err) {
            if (ret.status && ret.eventType == 'show') {
                var UIScrollPictureEl = $api.byId('UIScrollPicture');
                if (UIScrollPictureEl) {
                    $api.css(UIScrollPictureEl, 'height:' + h + 'px');
                }
            } else if (ret.status && ret.eventType == 'click') {
                sendEventUmeng(CONSTANT.UMENGEVENT.SCROLL_PICTURE, {
                    "index": ret.index+''
                });
                goAd(ret.index);
            }
        });
    }
    //刷新顶部图片轮放
    function refreshAdHtml(ad) {
        if (!isDefine(UIScrollPicture)) {
            getAdHtml(ad);
        } else {
            UIScrollPictureUrls = ad.list.map(function (value) {
                return {url: value.url, name: value.name};
            });
            var paths = ad.list.map(function (value) {
                return getImgUrl(imgPath, value.img, CONSTANT.PICTUREOSS.Q80);
            });
            UIScrollPicture.reloadData({
                data: {
                    paths: paths
                }
            });
            UIScrollPicture.setCurrentIndex({
                index: 1
            });
        }
    }

    //其他banner广告
    function getOtherAdHtml(data, test) {
        var html = doTHtml('other-ad-container-template', data);
        if (test == 'test') {
            console.log(html);
        }
//		console.log(html);
        var containerEl = $api.byId('other-ad-container');
        if (containerEl) {
            containerEl.innerHTML = html;
//            _imgCacheUrl3(containerEl);
            api.parseTapmode();
        }
    }

    //点击轮播图片
    function goAd(index) {
        var value = UIScrollPictureUrls[index];
        if (!isDefine(value.url)) {
            return;
        }
        var isNeedLogin = isNeedLoginUrl(value.url);
        if (isNeedLogin && !isLogin()) {
            goLogin();
            return;
        } else {
            api.openWin({
                name: 'adweb',
                url: 'winWeb.html',
                pageParam: {
                    url: value.url,
                    title: '多啦衣梦',
                    name: value.name || "快来看啊，一个有趣的东西！"
                }
            });
        }
    }

    //跳转选衣达人页面
    function goChoose() {
        if (!isLogin()) {
            goLogin();
            return;
        }
        //换成新的header_new.html
        var name = 'choose';
        var title = '选衣达人';
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execCloseSlefWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var border = true;
        var bounces = false;
        var params = {};
        params.nav = setNav(leftNav, border);
        params.frame = setFrame(bounces);
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'header_new.html';
        var animation = '';
        var page = 'choose.html';
        sendEventUmeng(CONSTANT.UMENGEVENT.ICON_MODULE, {
            name: title
        });
        openNewWinFrame(name, title, params, from, url, animation, page);
    }

    //跳转秋季预选页面
    function goSeason() {
        var name = 'season';
        var title = CONSTANT.TEXT.PRESELBEFORE;
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execCloseSlefWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var border = true;
        var bounces = false;
        var params = {};
        params.nav = setNav(leftNav, border);
        params.frame = setFrame(bounces);
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'header_new.html';
        var animation = '';
        var page = 'season.html';
        sendEventUmeng(CONSTANT.UMENGEVENT.ICON_MODULE, {
            name: title
        });
        openNewWinFrame(name, title, params, from, url, animation, page);
    }


    //跳转人气排行页面
    function goPopularity(flag) {
        if (flag == 'model') {
            sendEventUmeng(CONSTANT.UMENGEVENT.ICON_MODULE, {
                name: '人气排行'
            });
        } else {
            sendEventUmeng(CONSTANT.UMENGEVENT.HOT_MODULE, {
                name: '人气排行'
            });
        }
        var name = 'chooseRank_new';
        var title = '排行榜';
        var leftIcon = 'duola-iconfont icon-left';
        var leftNav = setNavData(leftIcon);
        var border = true;
        var bounces = true;
        var params = {};
        params.nav = setNav(leftNav, border);
        params.tab = {
            "hitColor": "nav-tab-hit-color",
            "leftTab": {
                "class": "a",
                "style": "font-size:0.85rem;",
                "activeIcon": "",//单个不能有空格
                "icon": "",
                "text": "周排行",
                "callback": "execSwitchNavTab",
                "extra": ""
            },
            "rightTab": {
                "class": "b",
                "style": "font-size:0.85rem;",
                "activeIcon": "",
                "icon": "",
                "text": "总排行",
                "callback": "execSwitchNavTab",
                "extra": ""
            }
        };
        params.frame = setFrame(bounces, {
            _id: "tab0"
        });
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'chooseRank_header.html';
        openNewWinFrame(name, title, params, from, url);
    }
    //点击返回图标异步执行关闭窗口
    function execSwitchNavTab(extra, winName, frameName, value) {
//		console.log(getLogStr([extra,winName,frameName,value]));
        var callback = 'execSwitchNav';
        var params = {
            script: getExecScript(callback, new Array(extra, value))
        };
        if (isDefine(winName)) {
            params.name = winName;
        }
        if (isDefine(frameName)) {
            params.frameName = frameName;
        }
        api.execScript(params);
    }

    //跳转年费专区页面
    function goYearVip() {
        var name = 'yearVip';
        var title = '年费会员VIP专区';
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execCloseSlefWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var border = true;
        var bounces = true;
        var params = {};
        params.nav = setNav(leftNav, border);
        params.frame = setFrame(bounces);
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'yearVip.html';
        var animation = '';
        var page = 'yearVip_0.html';
        sendEventUmeng(CONSTANT.UMENGEVENT.ICON_MODULE, {
            name: title
        });
        openNewWinFrame(name, title, params, from, url, animation, page);
    }

    //跳转主题详情页面
    function goThemeDatail(id, index) {
        var name = 'content';
        var title = '主题';
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execCloseSlefWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var rightNav = "";
        if (isWechat) {
            var rightIcon = 'duola-iconfont icon-share';
            rightNav = setNavData(rightIcon);
        }
        var border = true;
        var bounces = false;
        var params = {};
        params.nav = setNav(leftNav, border, rightNav);
        params.frame = setFrame(bounces, {
            id: id
        });
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'header_new.html';
        var animation = '';
        var page = 'content_new.html';
        sendEventUmeng(CONSTANT.UMENGEVENT.THEME, {
            'index': index+''
        });
        openNewWinFrame(name, title, params, from, url, animation, page);
    }

    //点击更多跳转页面
    function goMore(keyword) {
        sendEventUmeng(CONSTANT.UMENGEVENT.HOT_MODULE, {
            name: keyword
        });
        if (keyword == CONSTANT.TEXT.PRESELBEFORE) {
            goSeason();
            return;
        }
        var name = 'clothMore';
        var title = keyword;
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execCloseSlefWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var border = true;
        var bounces = true;
        var params = {};
        params.nav = setNav(leftNav, border);
        params.frame = setFrame(bounces, {
            value: keyword
        });
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'header_new.html';
        var animation = '';
        var page = 'clothMore.html';
        openNewWinFrame(name, title, params, from, url, animation, page);
    }

    //点击返回图标异步执行关闭窗口
    function execCloseSlefWin(extra, winName, value) {
        api.closeWin({
            name: winName
        });
    }

    //点击推荐跳转页面
    function goRecommend() {
        if (!isLogin()) {
            goLogin();
            return;
        }
        var name = 'Recommend';
        var title = '推荐有奖';
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execCloseSlefWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var border = true;
        var bounces = false;
        var params = {};
        params.nav = setNav(leftNav, border);
        params.frame = setFrame(bounces, null, true);
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'header_web.html';
        var animation = '';
        var page = 'user/userRecommend.html';
        sendEventUmeng(CONSTANT.UMENGEVENT.SHARE_AWARD, {
            from: '首页'
        });
        openNewWinFrame(name, title, params, from, url, animation, page);
    }

    //打开游戏页面
    function goH5Game(url) {
        var title = getUrlParam(url, 'title').indexOf('%') == -1 ? getUrlParam(url, 'title') : '多啦衣梦';
        var page = url.split('?')[0] + '?userPhone=' + $api.getStorage('userPhone');
        var name = 'h5game';
        var leftIcon = 'duola-iconfont icon-left';
        var leftNav = setNavData(leftIcon);
        var rightIcon = 'duola-iconfont icon-share';
        var rightNav = setNavData(rightIcon);
        var border = true;
        var bounces = false;
        var params = {};
        params.nav = setNav(leftNav, border, rightNav, '#FFFFFF');
        params.frame = setFrame(bounces, {
            sharedPage: url
        });
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
//		var headerUrl = 'header_web.html';
        var headerUrl = 'header_web_trans.html';//透明头部
        openNewWinFrame(name, title, params, from, headerUrl, null, page);
    }

    //其他广告点击处理
    function otherAdClickHandler(i, type, data) {
        sendEventUmeng(CONSTANT.UMENGEVENT.OTHER_AD, {'index': i+''});
        if (type == 'internal' && data) {
            //打开内部APP页面
            if (data == 'goActivity' && !isLogin()) {
                goLogin();
                return;
            }
            var functionName = getExecScript(data);
            eval(functionName);
        } else if (type == 'outer' && data) {
            //打开外面weburl
            var isNeedLogin = isNeedLoginUrl(data);
            if (isNeedLogin && !isLogin()) {
                goLogin();
                return;
            } else {
                if (isTrue(getUrlParam(data, 'h5game'))) {
                    goH5Game(data);
                } else {
                    var title = getUrlParam(data, 'title') && getUrlParam(data, 'title').indexOf('%') == -1 ? getUrlParam(data, 'title') : '多啦衣梦';
                    var leftIcon = 'duola-iconfont icon-left';
                    var leftNav = setNavData(leftIcon);
                    var rightIcon = 'duola-iconfont icon-share';
                    var rightNav = setNavData(rightIcon);
                    var border = true;
                    var bounces = false;
                    var params = {};
                    params.nav = setNav(leftNav, border, rightNav);
                    //分享url和加载的url 不一致
                    params.frame = setFrame(bounces, {
                        sharedPage: data
                    });
                    var from = {
                        winName: api.winName,
                        frameName: api.frameName
                    };
                    var url = 'header_web.html';
                    openNewWinFrame(name, title, params, from, url, null, data);
                }
            }
        }
    }

    //跳转双十一活动页面
    function goActivity() {
        var name = 'activity';
        var title = '买1送1';
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execCloseSlefWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var rightNav = "";
        if (isWechat) {
            var rightIcon = 'duola-iconfont icon-share';
            rightNav = setNavData(rightIcon);
        }
        var border = true;
        var bounces = true;
        var params = {};
        params.nav = setNav(leftNav, border, rightNav);
        params.frame = setFrame(bounces);
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'header_new.html';
        var animation = '';
        var page = 'activity.html';
        openNewWinFrame(name, title, params, from, url, animation, page);
    }

    //跳转圣诞元旦闪选活动页面
    function goFlashLease(){
        var name = 'marquee';
        var title = '多啦闪选';
        var leftIcon = 'duola-iconfont icon-left';
        var leftText = '';
        var leftExtra = '';
        var leftCallback = 'execMarqueeWin';
        var leftNav = setNavData(leftIcon, leftText, leftCallback, leftExtra);
        var border = false;
        var bounces = false;
        var params = {};
        params.nav = setNav(leftNav, border);
        params.frame = setFrame(bounces);
        var from = {
            winName: api.winName,
            frameName: api.frameName
        };
        var url = 'header_new.html';
        var animation = '';
        var page = 'activity_marquee.html';
        openNewWinFrame(name, title, params, from, url, animation, page);
    }
    //点击返回图标异步执行关闭窗口
    function execMarqueeWin(extra,winName,value){
        var scriptFun = getExecScript('execClear', []);
        var params = {
            name:'marqueeWin',
            frameName: 'marqueeFrame',
            script: scriptFun
        };
        api.execScript(params);
        api.closeWin({
            name:winName
        });
    }
</script>
</html>
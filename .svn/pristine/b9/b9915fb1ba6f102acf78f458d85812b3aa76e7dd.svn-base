<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport"
          content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>品牌详情</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/2_0/aui_2_0.css"/>
    <link rel="stylesheet" type="text/css" href="../css/2_0/rem.css"/>
    <link rel="stylesheet" type="text/css" href="../css/2_0/util.css"/>
    <link rel="stylesheet" type="text/css" href="../css/fonts/duola_iconfont2.css"/>
    <style>
        #cloudset-container{
            margin: 0;
        }
        .waterfall .item{
            background-color: #fff;
            padding-top: 2rem;
            padding-bottom: 1.5rem
        }
        .waterfall .size{
            padding: 0;
            text-align: center;
            margin-top: 0.4rem;
        }
        .waterfall .size span{
            font-weight: 600;
            margin: 0 0.2rem;
            font-size: 0.6rem;
            line-height: 0.6rem;
            font-family: ArialMT;
            color: #464646;
        }
        .waterfall .item .footer .name{
            text-align: center;
            font-family: SourceHanSansCN-Normal;
            font-size: 0.55rem;
            color: #464646;
            margin-top: 0.65rem;
            line-height: 0.55rem;
        }

        .waterfall .item .footer{
            padding-top: 0;
        }
        .waterfall .item .number{
            line-height: 0.5rem;
            font-size: 0.5rem;
            margin-top: 0.4rem;
        }
        .waterfall .item  .number span{
            line-height: 0.5rem;
            font-size: 0.5rem;
            height: 0.5rem;
        }
        .shadow-11{
            width: 100%;
            height: 0.55rem;
            background: #EBEBEB;
            box-shadow: inset 0px 1px 1px 0px rgba(0,0,0,0.15);
        }

        /*品牌大图*/
        .design-name{
            height: 2.4rem;
            line-height: 2.4rem;
            text-align: left;
            padding: 0 1.5rem;
            /*font-family: SourceHanSansCN-Medium;*/
            font-family: SourceHanSansCN-Normal;
            font-size: 0.7rem;
            color: #FFFFFF;
            letter-spacing: 0px;
        }
        .design-name-bold{
            font-weight: 700;
        }
        .icon-line{
            font-weight: 700;
            font-size: 0.7rem;
        }
        .shadow-11{
            width: 100%;
            height: 0.55rem;
            background: #F5F5F5;
            box-shadow: inset 0px 1px 1px 0px rgba(0,0,0,0.15);
        }

    </style>
</head>
<body>

<div id="pagination">
    <div class="pagination-bg-1" onclick="changeTop()">
        <div id="pagination-pag">
            <div class="pagination-num" id="pagination-page">1页</div>
            <div class="pagination-name" id="pagination-pageTotal"></div>
            <!--<em id="pagination_page">111</em>/<em id="pagination_pageTotal">312</em>-->

        </div>
        <div id="pagination-top" class="pagination-tops hide">
            <i class="duola-iconfont icon-dingbu"></i>
        </div>
    </div>
</div>

<div id="brand-container">
    <img src="../image/hold.jpg" width="100%"/>
    <!--<img src="../image/hold.jpg" class="duo-cache-img" title="http://img.duolayimeng.com/brand/yy2PD76zdF.jpg@40q"/>-->
    <!--<div class="design-name word-wrap" style="background:rgb(32,178,170);">-->
        <!--<span class="design-name-bold">古特</span>&nbsp;&nbsp;<span class="duola-iconfont icon-line"></span>&nbsp;&nbsp;短语-->
    <!--</div>-->
</div>

<div class="aui-grid">
    <div id="cloudset-container" class="waterfall">

        <!--<div id="duo-cache-page-cloudset1" class="aui-row">-->
            <!--<div class="item aui-col-xs-6" tapmode onclick="showClothes('undefined')" style="padding-left: 0.4rem;">-->
                <!--<div class="header"><img src="../image/hold.jpg" class="duo-cache-img"-->
                                         <!--title="http://img.duolayimeng.com/original/1534605-1.jpg@320w_90q"/>-->
                    <!--<div class="label flex flex-space-between">-->
                        <!--<div></div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="footer">-->
                    <!--<div class="name aui-ellipsis-1">圆领长袖连衣裙</div>-->
                <!--</div>-->
                <!--<div class="size flex flex-center"><span>XS</span> <span>S</span> <span>M</span> <span>L</span>-->
                    <!--<span>XL</span></div>-->
                <!--<div class="number"><span class="duola-iconfont icon-love"></span>30</div>-->
            <!--</div>-->
            <!--<div class="item aui-col-xs-6" tapmode onclick="showClothes('undefined')" style="padding-right: 0.4rem;">-->
                <!--<div class="header"><img src="../image/hold.jpg" class="duo-cache-img"-->
                                         <!--title="http://img.duolayimeng.com/original/1534566-1.jpg@320w_90q"/>-->
                    <!--<div class="label flex flex-space-between">-->
                        <!--<div></div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="footer">-->
                    <!--<div class="name aui-ellipsis-1">时尚修身短款外套</div>-->
                <!--</div>-->
                <!--<div class="size flex flex-center"><span>XS</span> <span>S</span> <span>M</span> <span>L</span>-->
                    <!--<span>XL</span></div>-->
                <!--<div class="number"><span class="duola-iconfont icon-love"></span>5</div>-->
            <!--</div>-->
            <!--<div class="aui-row shadow-11"></div>-->
            <!--<div class="item aui-col-xs-6" tapmode onclick="showClothes('undefined')" style="padding-left: 0.4rem;">-->
                <!--<div class="header"><img src="../image/hold.jpg" class="duo-cache-img"-->
                                         <!--title="http://img.duolayimeng.com/original/1534485-1.jpg@320w_90q"/>-->
                    <!--<div class="label flex flex-space-between">-->
                        <!--<div></div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="footer">-->
                    <!--<div class="name aui-ellipsis-1">时尚钉珠牛仔</div>-->
                <!--</div>-->
                <!--<div class="size flex flex-center"><span>XS</span> <span>S</span> <span>M</span> <span>L</span>-->
                    <!--<span>XL</span></div>-->
                <!--<div class="number"><span class="duola-iconfont icon-love"></span>38</div>-->
            <!--</div>-->
            <!--<div class="item aui-col-xs-6" tapmode onclick="showClothes('undefined')" style="padding-right: 0.4rem;">-->
                <!--<div class="header"><img src="../image/hold.jpg" class="duo-cache-img"-->
                                         <!--title="http://img.duolayimeng.com/original/1534369-1.jpg@320w_90q"/>-->
                    <!--<div class="label flex flex-space-between">-->
                        <!--<div></div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="footer">-->
                    <!--<div class="name aui-ellipsis-1">粉色显瘦上衣</div>-->
                <!--</div>-->
                <!--<div class="size flex flex-center"><span>XS</span> <span>S</span> <span>M</span> <span>L</span>-->
                    <!--<span>XL</span></div>-->
                <!--<div class="number"><span class="duola-iconfont icon-love"></span>10</div>-->
            <!--</div>-->
        <!--</div>-->

    </div>
</div>

<div id="loading" class="aui-text-center" style="font-size: 12px; color: #999999;">
    <img src="../icon/loading.gif" width="16" />
    <div>更多数据加载中</div>
</div>

<script id="brand-container-template" type="text/x-dot-template">
    <img src="../image/hold.jpg" class="{{=CONSTANT.CACHECLASSNAME}}" title="{{=getImgUrl(CONSTANT.PICPRE.BRAND,it.detailImg || it.img,CONSTANT.PICTUREOSS.Q80)}}"/>
    <div class="design-name word-wrap" style="{{=getBackgroudColor(it.bgColor)}}"><span class="design-name-bold">{{=it.name}}</span>&nbsp;&nbsp;<span class="duola-iconfont icon-line"></span>&nbsp;&nbsp;{{=it.slogan || it.special}}</div>
</script>

<script id="cloudset-container-template" type="text/x-dot-template">
    <div id="{{=CONSTANT.CACHEPAGEID+'cloudset'+currPage}}" class="aui-row">
        {{ for(var i = 0; i < it.count; i++) { }}
        <div class="item aui-col-xs-6" tapmode onclick="{{=getExecScript('showClothes',[it.list[i]._id])}}" style="{{=(i+1)%2 == 0 ? 'padding-right: 0.4rem;' : 'padding-left: 0.4rem;' }}">
            <div class="header">
                <img src="../image/hold.jpg" class="{{=CONSTANT.CACHECLASSNAME}}" title="{{=getImgUrl(colthPath, it.list[i].img, CONSTANT.PICTUREOSS.CLOTHESLIST)}}"/>
                <div class="label flex flex-space-between">
                    {{? isTrue(it.list[i] && it.list[i].new)}}
                    <div class="new">new</div>
                    {{??}}
                    <div></div>
                    {{?}}
                    {{? isTrue(it.list[i] && it.list[i].available)}}
                        <div class="unavailable">抢光了</div>
                    {{?}}
                </div>
            </div>
            <div class="footer">
                <div class="name aui-ellipsis-1">{{=(it.list[i] && it.list[i].name) ? it.list[i].name : '多啦衣梦'}}</div>
            </div>
            {{? it.list[i].size.length > 0 }}
                <div class="size flex flex-center">
                    {{~it.list[i].size:value:index}}
                        <span>{{=(value.toUpperCase() == 'J') ? '均码' : value}}</span>
                    {{~}}
                </div>
            {{?}}
            <div class="number"><span class="duola-iconfont icon-love"></span>{{=it.list[i].popularity ? it.list[i].popularity : 0}}</div>
        </div>
        {{? (i+1)%2 == 0 && !((i+1) == it.count && currPage == totalPage) }}
            <div class="aui-row shadow-11" ></div>
        {{?}}
        {{ } }}
    </div>
</script>


</body>
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/url.js"></script>
<script type="text/javascript" src="../script/doT_min.js"></script>
<script type="text/javascript" src="../script/uz.js"></script>
<script type="text/javascript" src="../script/components/pagination.js"></script>
<script type="text/javascript" src="../script/umeng_sdk.js"></script>
<script type="text/javascript">
    var frameData = null;
    var _id;
    var currPage = 1;
    var totalPage = 1;
    //加载更多时候，服务器是否返回，以免用户多次触发
    var isLoadMoreResponsed = true;
    apiready = function(){
        frameData = api.pageParam.data;
        _id = isDefine(frameData._id) ? frameData._id : 0;
        init(CONSTANT.ACTIONINIT);
        loadMore();
        pullRefresh(loadRefresh);
        api.parseTapmode();
    };

//    testHtml();
    function testHtml(){
//        var ret = {"statusCode":200,"msg":"OK","_id":"YKi8dtnKGfWja2txf","name":"SHOW·魅","special":"SHOW·魅","slogan":"前卫的魅力潮牌","img":"NsJ45QJ5TG.jpg","logo":"2WDf63QMZM.jpg","bgColor":"#fff","detailImg":"bt4CyeJbGY.jpg","count":20,"page":1,"pageSize":20,"pageTotal":2,"list":[{"_id":"1528136","name":"小高领蝴蝶结装饰长款外套","img":"1528136-1.jpg","size":["M"]},{"_id":"1530012","name":"条纹阔腿裤","img":"1530012-1.jpg","popularity":2,"size":["XS","S","M","L","XL"]},{"_id":"1526206","name":"浅蓝彩点露肩套头衬衫裙","img":"1526206-1.jpg","popularity":4,"size":["XS","S","M","L","XL"]},{"_id":"1527799","name":"拼条卫衣","img":"1527799-1.jpg","popularity":16,"size":["XS","S","M","L","XL"]},{"_id":"1533646","name":"连衣裙","img":"1533646-1.jpg","popularity":16,"size":["M","S"]},{"_id":"1533663","name":"连衣裙","img":"1533663-1.jpg","popularity":2,"size":["L"]},{"_id":"1529490","name":"长袖V领T","img":"1529490-1.jpg","popularity":6,"size":["XS","S","M","L","XL"]},{"_id":"1529661","name":"涂鸦外套","img":"1529661-1.jpg","popularity":74,"size":["XS","S","M","L","XL"]},{"_id":"1532022","name":"绿色长款大衣","img":"1532022-1.jpg","popularity":8,"size":["J"]},{"_id":"1531779","name":"复古文艺套头木耳边长袖圆领收腰裙摆连衣裙","img":"1531779-1.jpg","popularity":8,"size":["XS","S","M","L","XL"]},{"_id":"1534683","name":"西装领中长款外套","img":"1534683-1.jpg","popularity":81,"size":["XS","S","M","L","XL"]},{"_id":"1534586","name":"时尚气质宽松外套","img":"1534586-1.jpg","popularity":20,"size":["XS","S","M","L","XL"]},{"_id":"1534562","name":"保暖加绒外套","img":"1534562-1.jpg","popularity":33,"size":["XS","S","M","L","XL"]},{"_id":"1534426","name":"灰色麂皮风衣（腰带）","img":"1534426-1.jpg","popularity":34,"size":["XS","S","M","L","XL"]},{"_id":"1533824","name":"格子连衣裙","img":"1533824-1.jpg","popularity":33,"size":["XS","S","M","L","XL"]},{"_id":"1528094","name":"时尚抽绳外套","img":"1528094-1.jpg","popularity":28,"size":["XS","S","M","L","XL"]},{"_id":"1534650","name":"时尚气质宽松外套","img":"1534650-1.jpg","popularity":32,"size":["XS","S","M","L","XL"]},{"_id":"1534568","name":"时尚简约套装","img":"1534568-1.jpg","popularity":63,"size":["XS","S","M","L","XL"]},{"_id":"1534490","name":"刺绣麂皮风衣外套","img":"1534490-1.jpg","popularity":88,"size":["XS","S","M","L","XL"]},{"_id":"1534372","name":"文艺旗袍式连衣裙","img":"1534372-1.jpg","popularity":53,"size":["XS","S","M","L","XL"]}]};
//        if(currPage == 1){
//            getBrandHtml({
//                name:ret.name,
//                img:ret.img,
//                detailImg:ret.detailImg,
//                special:ret.special,
//                slogan:ret.slogan,
//                bgColor:ret.bgColor
//            },true);
//        }
//        getClothHtml(ret,true);
    }


    //下拉刷新
    function loadRefresh(){
        currPage = 1;
        init(CONSTANT.ACTIONREFRESH);
    }

    //加载更多
    function loadMore(){
        api.addEventListener({
            name:'scrolltobottom',
            extra:{threshold:0}
        }, function(ret, err){
            if(isLoadMoreResponsed && currPage < totalPage){
                currPage++;
                isLoadMoreResponsed = false;
                init(CONSTANT.ACTIONLOAD);
            }
        });
    }

    function initSuccessCallback(ret,extra) {
        var action = extra.action;
        if(action == CONSTANT.ACTIONREFRESH){
            pullRefreshDone();
        }else if(action == CONSTANT.ACTIONLOAD){
            isLoadMoreResponsed = true;
            loadingHide();
        }else{
            loadingHide();
        }
        if(ret.statusCode==200){
            currPage = ret.page;
            totalPage = ret.pageTotal;
            if(currPage == 1){
                //第一次加载
                getBrandHtml({
                    name:ret.name,
                    img:ret.img,
                    detailImg:ret.detailImg,
                    special:ret.special,
                    slogan:ret.slogan,
                    bgColor:ret.bgColor
                });
            }
            getClothHtml(ret);
            _page(currPage,totalPage,ret.count);
        }else{
            toastMsg(ret.msg);
        }
        if(currPage >= totalPage){
            $api.html($api.byId('loading'),'没有更多了');
        }
    }
    function initErrorCallback(err,extra){
        var action = extra.action;
        if(action == CONSTANT.ACTIONREFRESH){
            pullRefreshDone();
        }else if(action == CONSTANT.ACTIONLOAD){
            isLoadMoreResponsed = true;
            currPage--;
            loadingHide();
        }else{
            loadingHide();
        }
        toastMsg(err.msg);
    }
    function init(action){
        if(action == CONSTANT.ACTIONINIT){
            loadingShow();
        }
        var url = serviceNew + 'leaseBrand/detail/'+_id;
        var headers = _getAjaxHeaders(false,true);
        var data = _getAjaxData({
            page: currPage,
            pageSize: CONSTANT.PAGESIZE
        });
        var extra = {action:action};
        _ajaxData(url,'post',headers,data,initSuccessCallback,initErrorCallback,0,extra);
    }

    //渲染品牌html
    function getBrandHtml(data,debug){
        var html = doTHtml('brand-container-template',data);
        if(debug)console.log(html);
        var brandContainer = $api.byId('brand-container');
        $api.html(brandContainer, html);
        if(!debug)_imgCacheUrl3(brandContainer);
    }

    //渲染衣服列表
    function getClothHtml(data,debug){
        var html = doTHtml('cloudset-container-template',data);
        if(debug)console.log(html);
        var cloudsetContainer = $api.byId('cloudset-container');
        if(currPage == 1){
            //首次加载或者刷新
            //图片也刷新了，闪屏，有待于提升性能
            cloudsetContainer.innerHTML = '';
        }
        $api.append(cloudsetContainer, html);
        var currPageElId = CONSTANT.CACHEPAGEID+'cloudset'+currPage;
        _imgCacheUrl3(cloudsetContainer,currPageElId);
        api.parseTapmode();
    }

    //更改列表品牌背景颜色
    function getBackgroudColor(bgColor){
        if(!isDefine(bgColor)){
            return 'color:#707070;';
        }
        bgColor = bgColor.toLowerCase();
        var style = 'background:'+bgColor+';';
        if(bgColor == '#ffffff' || bgColor == '#fff' || bgColor == 'rgb(255,255,255)'){
            style += 'color:#707070;border-bottom:1px solid #ccc;';
        }
        return style;
    }

    function execDetail(exec_id,title){
        _id = exec_id;
        init(CONSTANT.ACTIONINIT);
        var execScriptFun = getExecScript('execChangeTitle',[title]);
        api.execScript({
            script: execScriptFun
        });
    }
</script>
</html>